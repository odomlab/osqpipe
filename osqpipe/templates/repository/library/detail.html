{% extends "repository/base.html" %}

{% load sortby %}

{% load humanize %}

{% block title %} Library {{ library }} Summary {% endblock %}

{% block content %}
  {% if library %}

  <div class="project_picker">
    <form action="" method="post">{% csrf_token %}
      {{ form.as_p }}
      <input type="submit" value="Change"/>
      <input type="reset" value="Reset"/>
    </form>
  </div>

  <table class="horizontal">
    <tr><th>Library code: </th><td>{{ library.code }}</td></tr>
    <tr><th>Requested Genome: </th>
      <td>{% with gen=library.genome %}
        {{ gen }} ({{ gen.scientific_name }}; {{ gen.common_name }}; version: {{ gen.version }})
        {% endwith %}</td></tr>
    <tr><th>Strain: </th><td>{{ library.strain }}</td></tr>
    <tr><th>Tissue: </th><td>{{ library.tissue }}</td></tr>
    <tr><th>Sex: </th><td>{{ library.sex }}</td></tr>
    <tr><th>Antibody: </th><td>{{ library.antibody }}
        {% if library.antibody %} (lot: {{ library.antibody.lot_number }}){% endif %}</td></tr>
    <tr><th>Individual: </th><td>{{ library.individual }}</td></tr>
    <tr><th>Factor: </th><td>{{ library.factor }}</td></tr>
    <tr><th>Library type: </th><td>{{ library.libtype }}</td></tr>
    <tr><th>Barcode: </th><td>{{ library.barcode }}</td></tr>
    <tr><th>Linkerset: </th><td>{{ library.linkerset }}</td></tr>
    <tr><th>Adapter: </th><td>{{ library.adapter }}{% if library.adapter %} (sequence: {{ library.adapter.sequence }}){% endif %}</td></tr>
    <tr><th>Experiment: </th><td>{{ library.chipsample }}</td></tr>
    <tr><th>Single or Paired-End: </th><td>{{ library.paired|yesno:"PE,SE" }}
        {% if library.lane_set.all.count > 0 %}
        &nbsp;&nbsp;( lanes: {% for lane in library.lane_set.all %}{{ lane.paired|yesno:"PE,SE" }} {% endfor %})
        {% endif %}
    </td></tr>
    <tr><th>Comment: </th><td>{{ library.comment }}</td></tr>
    <tr><th>Bad: </th><td>{{ library.bad|yesno }}</td></tr>
  </table>

  <h2>Sequencing Lanes</h2>
  
  {% if library.lane_set.all.count > 0 %}
  <table>
    <tr>
      <th>Lane</th>
      <th>Facility</th>
      <th>Flowcell ID</th>
      <th>Flowlane</th>
      <th>Genomics ID</th>
      <th>Genomics Run No.</th>
      <th>Run Date</th>
      <th>Reads Passed PF</th>
      <th>LIMS Summary</th>
    </tr>

    {% for lane in library.lane_set.all|sortby:"name" %}  
      <tr>
        <th><a href="{% url "lane-detail" pk=lane.pk %}">{{ lane.name }}</a></th>
        <td>{{ lane.facility.name }}</td>
        <td>{{ lane.flowcell }}</td>
        <td>{{ lane.flowlane }}</td>
        <td>{{ lane.genomicssampleid }}</td>
        <td>{{ lane.runnumber }}</td>
        <td>{{ lane.rundate }}</td>
        <td>{{ lane.total_passedpf|intcomma }}</td>
        <td>{% if lane.summaryurl %}
       <a href="{{lane.summaryurl}}">{{lane.machine}}_{{lane.flowcell}}_s_{{lane.flowlane}}</a>
          {% endif %}</td>
      </tr>
    {% endfor %}
  </table>
  {% else %}
    No Sequencing Lanes found.
  {% endif %}
{% comment %}
   <p><a href="{% url "library-edit" pk=library.pk %}">Edit</a></p>
{% endcomment %}
  {% else %}
  <p>No library provided.</p>
  {% endif %}
{% endblock %}    
